#!/usr/bin/expect

set port [lindex $argv 0]
set timeout 10

spawn dolt --host 127.0.0.1 --port $port --no-tls sql --skip-binary-as-hex
expect ">"

send "USE repo1;\r"
expect ">"

send "SELECT * FROM binary_test;\r"
expect {
    -re "\\| 1  \\|.*\\|" {
        # Found raw binary output (not hex) - this is correct for skip flag
        expect ">"
        send "exit\r"
        expect eof
        exit 0
    }
    timeout {
        send "exit\r"
        expect eof
        exit 1
    }
}