#!/usr/bin/expect

set timeout 10
log_user 0

# Test with --skip-binary-as-hex flag
spawn dolt sql --skip-binary-as-hex
expect ">"

send "CREATE TABLE test_binary (pk INT PRIMARY KEY, vb VARBINARY(20));\r"
expect ">"

send "INSERT INTO test_binary VALUES (1, 0x0A000000), (2, 'abc');\r"
expect ">"

send "SELECT * FROM test_binary;\r"
expect {
    -re {\\| 2.*\\| abc \\|} {
        expect ">"
        send "exit\r"
        expect eof
        exit 0
    }
    "0x616263" {
        send "exit\r"
        expect eof
        exit 1
    }
    "0x0A000000" {
        send "exit\r"
        expect eof
        exit 1
    }
    timeout {
        send "exit\r"
        expect eof
        exit 1
    }
}